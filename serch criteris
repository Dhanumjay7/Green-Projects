Solution Overview

We refactored the logic so that no single search is too heavy and all searches are paged:

Split the big transaction search into three dedicated saved searches:

SEARCH_SO_PT2 – Sales Orders, payment type = 2

SEARCH_INV_PT2 – Invoices, payment type = 2

SEARCH_INV_PT1 – Invoices, payment type = 1

Run each saved search separately from the script and page through results using runPaged({ pageSize: 500 }).

Keep all customer-specific logic in the script:

Add filters for customer, currency, last statement date, email not empty, and arrival date split (before/after mid-date or >= ARRIVAL_DATE parameter) on top of each saved search at runtime.
