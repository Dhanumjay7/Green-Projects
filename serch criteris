Solution Overview

We refactored the logic so that no single search is too heavy and all searches are paged:

Split the big transaction search into three dedicated saved searches:

SEARCH_SO_PT2 – Sales Orders, payment type = 2

SEARCH_INV_PT2 – Invoices, payment type = 2

SEARCH_INV_PT1 – Invoices, payment type = 1

Run each saved search separately from the script and page through results using runPaged({ pageSize: 500 }).

Keep all customer-specific logic in the script:

Add filters for customer, currency, last statement date, email not empty, and arrival date split (before/after mid-date or >= ARRIVAL_DATE parameter) on top of each saved search at runtime.

Technical Changes
1. New script parameters

On the script/deployment we added 3 parameters and pass saved search IDs:

custscript_weeklyst_searchtransactions → SEARCH_SO_PT2

custscript_search_inv_pt2 → SEARCH_INV_PT2

custscript_search_inv_pt1 → SEARCH_INV_PT1

getFileConst() now reads:

function getFileConst() {
    return {
        SEARCH_INPUT:  getScriptParam('custscript_weeklyst_searchinput'),
        SEARCH_SO_PT2: getScriptParam('custscript_weeklyst_searchtransactions'),
        SEARCH_INV_PT2:getScriptParam('custscript_search_inv_pt2'),
        SEARCH_INV_PT1:getScriptParam('custscript_search_inv_pt1'),
        ARRIVAL_DATE:  getScriptParam('custscript_weeklyst_searcharrivaldate') || '',
        RESUME_FROM_CUSTOMER: getScriptParam('custscript_resume_from_customer') || ''
    };
}

2. New getTransactions() flow

Instead of building a huge filter array, getTransactions() now:

Builds base filters that must always apply:

customermain.internalidnumber = customer

currency = <currency>

customer.custentity_upaya_last_statement_date != today

customer.custentity_2663_email_address_notif is not empty

Computes a mid date (01/01/2016 – today midpoint) and then:

If ARRIVAL_DATE parameter is set:

Adds custbody_arrival_date ONORAFTER ARRIVAL_DATE and calls each saved search once.

Else:

Builds two extra filters:

custbody_arrival_date BEFORE midDateStr

custbody_arrival_date ONORAFTER midDateStr

Calls each saved search twice (before + after mid-date) to keep each search window smaller.

For each combination, it calls runSavedTransactionSearch(searchId, extraFilters) and concatenates the results.
