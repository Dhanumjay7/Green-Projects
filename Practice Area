function reduce(context) {

    var agentCode = context.values[0];
    if (!agentCode) return;

    var results = getTransactions(agentCode);
    var rows = [];

    var inactiveRows = checkInactiveAgents(results);
    if (inactiveRows.length) {
        rows = inactiveRows;
    } else {
        var acsRows = checkMissingACS(results);
        if (acsRows.length) {
            rows = acsRows;
        } else {
            var nonVoidRows = checkNonVoid(results);
            if (nonVoidRows.length) {
                // ⚠️ match old behavior: take ONLY FIRST row
                rows = [nonVoidRows[0]];
            }
        }
    }

    if (rows.length) {
        context.write('ROWS', rows.join('|'));
    }
}
